<?xml version="1.0" encoding="utf-8" ?>
<plugin name="listing_status">
    <title>Listing Labels</title>
    <description>Allows the Administrator to add custom labels which users will be able to stick to their ads</description>
    <author>Dmitry Azavanichus</author>
    <owner>Flynax classifieds software</owner>
    <version>3.1.0</version>
    <date>10.08.2012</date>
    <controller>listing_status</controller>
    <compatible>4.8.1</compatible>
    <class>ListingStatus</class>

    <files>
        <file>admin/listing_status.inc.php</file>
        <file>admin/listing_status.tpl</file>
        <file>admin/watermark.tpl</file>
        <file>admin/refresh_labels.tpl</file>
        <file>admin/verify_photos.inc.php</file>
        <file>admin/verify_photos.tpl</file>
        <file>rlListingStatus.class.php</file>
        <file>verify_photos.inc.php</file>
        <file>verify_photos.tpl</file>
        <file>admin/status_admin_selector.tpl</file>
        <file>status_selector.tpl</file>
        <file>label.box.tpl</file>
        <file>step.done.tpl</file>
        <file>recently_sold.block.tpl</file>
        <file>header.tpl</file>
        <file>static/lib.js</file>
        <file>static/style.css</file>
        <file>static/style-page.css</file>
        <file>sold_large.psd</file>
        <file>sold_large.png</file>
        <file>sold.psd</file>
        <file>sold.png</file>
        <file>i18n/ru.json</file>
    </files>

    <install><![CDATA[
        $GLOBALS['reefless']->loadClass('ListingStatus', null, 'listing_status');
        $GLOBALS['rlListingStatus']->install();
    ]]></install>

    <hooks>
        <hook version="3.0.0" name="init"><![CDATA[]]></hook>
        <hook version="3.0.0" name="specialBlock"><![CDATA[]]></hook>
        <hook version="3.0.0" name="listingsModifyWhere"><![CDATA[]]></hook>
        <hook version="3.0.0" name="listingsModifyWhereMyFavorite"><![CDATA[]]></hook>
        <hook version="3.0.0" name="listingsModifyWhereByPeriod"><![CDATA[]]></hook>
        <hook version="3.0.0" name="listingsModifyWhereByAccount"><![CDATA[]]></hook>
        <hook version="3.0.0" name="listingsModifyWhereSearch"><![CDATA[]]></hook>
        <hook version="3.0.0" name="phpListingsAjaxDeleteListing"><![CDATA[]]></hook>
        <hook version="3.0.0" name="cronAdditional"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apTplListingsFormEdit"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpListingsBottom"><![CDATA[]]></hook>
        <hook version="3.0.0" name="listingsModifyWhereFeatured"><![CDATA[]]></hook>
        <hook version="3.0.0" name="listingDetailsSql"><![CDATA[]]></hook>
        <hook version="3.0.0" name="sitemapGetListingsWhere"><![CDATA[]]></hook>
        <hook version="3.0.0" name="myListingsIconTop"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apTplControlsForm"><![CDATA[]]></hook>
        <hook version="3.0.0" name="staticDataRegister"><![CDATA[]]></hook>
        <hook version="3.0.0" name="ajaxRequest"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apAjaxRequest"><![CDATA[]]></hook>
        <hook version="3.0.0" name="phpUploadBeforeSaveData"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpBlocksPost"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpConfigAfterUpdate"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apTplBlocksBottom"><![CDATA[]]></hook>
        <hook version="3.0.0" name="tplFeaturedItemPhoto"><![CDATA[]]></hook>
        <hook version="3.0.0" name="tplListingItemPhoto"><![CDATA[]]></hook>
        <hook version="3.0.0" name="tplListingDetailsPhotoPreview"><![CDATA[]]></hook>
        <hook version="3.0.0" name="tplListingDetailsGalleryPreview"><![CDATA[]]></hook>
        <hook version="3.0.0" name="tplMyListingItemPhoto"><![CDATA[]]></hook>
        <hook version="3.0.0" name="phpPrepareListingsData"><![CDATA[]]></hook>
        <hook version="3.0.0" name="addListingStepActionsTpl"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpLanguageAfterImport"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpAfterAddLanguage"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpAfterDeleteLanguage"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpIndexBottom"><![CDATA[]]></hook>
        <hook version="3.0.0" name="phpRegisterFunctions"><![CDATA[]]></hook>
        <hook version="3.0.0" name="apPhpAfterChangeDefaultLanguage"><![CDATA[]]></hook>
        <hook version="3.1.0" name="tplHeader"><![CDATA[]]></hook>
        <hook version="3.1.0" name="phpDeleteListingDataBefore"><![CDATA[]]></hook>
    </hooks>

    <phrases>
        <phrase key="ls_block_list" module="admin"><![CDATA[All Labels]]></phrase>
        <phrase key="ls_watermark" module="common"><![CDATA[Label]]></phrase>
        <phrase key="ls_more_listings" module="admin"><![CDATA[The number of listings should not exceed 30.]]></phrase>
        <phrase version='3.1.0' key="ls_watermarks_hint" module="admin"><![CDATA[Choose a watermark file for the label with the recommended dimensions {size}x{size}px]]></phrase>
        <phrase key="ls_removal" module="admin"><![CDATA[Removed]]></phrase>
        <phrase key="ls_unchanged" module="admin"><![CDATA[Unchanged]]></phrase>
        <phrase key="ls_suspension" module="admin"><![CDATA[Suspended]]></phrase>
        <phrase key="ls_delete_days_hint" module="admin"><![CDATA[The listings will be removed or suspended once the period expires.]]></phrase>
        <phrase key="ls_latest" module="common"><![CDATA[Recently Added]]></phrase>
        <phrase key="ls_random" module="common"><![CDATA[Random]]></phrase>
        <phrase version="3.1.0" key="ls_use_block" module="common"><![CDATA[Display listings in box]]></phrase>
        <phrase key="ls_use_block_info" module="common"><![CDATA[Listings with the label will be displayed in a separate content box.]]></phrase>
        <phrase key="ls_status_block" module="common"><![CDATA[Box status]]></phrase>
        <phrase key="ls_block_name" module="common"><![CDATA[Box name]]></phrase>
        <phrase version="3.1.0" key="ls_block_add" module="common"><![CDATA[You have added the label.]]></phrase>
        <phrase version="3.1.0" key="ls_block_edit" module="common"><![CDATA[You have edited the label.]]></phrase>
        <phrase key="ls_block_settings" module="common"><![CDATA[Labeled listing box]]></phrase>
        <phrase key="ls_label" module="common"><![CDATA[Label]]></phrase>
        <phrase key="ls_add_label" module="common"><![CDATA[Add a Label]]></phrase>
        <phrase key="ls_edit_label" module="common"><![CDATA[Edit Label]]></phrase>
        <phrase version="2.1.0" key="ls_substatus" module="common"><![CDATA[Listing status]]></phrase>
        <phrase version="3.1.0" key="ls_visible" module="common"><![CDATA[Visible (default)]]></phrase>
        <phrase version="2.1.0" key="ls_invisible" module="common"><![CDATA[Invisible]]></phrase>
        <phrase version="2.1.0" key="lsl_sold" module="common"><![CDATA[Sold]]></phrase>
        <phrase version="3.0.0" key="lsl_verified" module="common"><![CDATA[Verified]]></phrase>
        <phrase version='2.1.0' key="ls_notice_visible" module="common"><![CDATA[The listing status has been changed to visible.]]></phrase>
        <phrase version='2.1.0' key="ls_notice_invisible" module="common"><![CDATA[The listing status was changed to invisible, and listings hidden from the front end.]]></phrase>
        <phrase version="2.1.0" key="ls_notice_sold" module="common"><![CDATA[Listing marked as sold]]></phrase>
        <phrase key="ls_notice_all" module="common"><![CDATA[Listing status changed to [status].]]></phrase>
        <phrase key="rsold_no_listings" module="common"><![CDATA[There are no <b>[label]</b> listings.]]></phrase>
        <phrase version='2.1.0' key="ls_label_large" module="common"><![CDATA[Enlarged Label]]></phrase>
        <phrase version='2.1.4' key="ls_rebuild_label" module="admin"><![CDATA[Update Labels]]></phrase>
        <phrase version='3.1.0' key="ls_notice_duplicate_position" module="common"><![CDATA[You may use the label in two positions; please, select a particular one.]]></phrase>
        <phrase version='3.0.0' key="ls_substatus_admin" module="admin"><![CDATA[Admin labels]]></phrase>
        <phrase version='3.0.0' key="ls_admin_labels_updated" module="admin"><![CDATA[Labels updated]]></phrase>
        <phrase version='3.0.0' key="ls_no_labels" module="admin"><![CDATA[There are no labels.]]></phrase>
        <phrase version='3.0.0' key="ls_type" module="admin"><![CDATA[Type]]></phrase>
        <phrase version='3.0.0' key="ls_image" module="common"><![CDATA[Image]]></phrase>
        <phrase version='3.0.0' key="ls_position_1" module="admin"><![CDATA[Top-left]]></phrase>
        <phrase version='3.0.0' key="ls_position_2" module="admin"><![CDATA[Top-right]]></phrase>
        <phrase version='3.0.0' key="ls_position_3" module="admin"><![CDATA[Bottom-right]]></phrase>
        <phrase version='3.0.0' key="ls_position_4" module="admin"><![CDATA[Bottom-left]]></phrase>
        <phrase version='2.4.0' key="ls_confirm_change_status" module="common"><![CDATA[Changing the status will disable the labels on the listings. Are you sure you want to proceed?]]></phrase>
        <phrase version='2.4.0' key="ls_change_on_inactive" module="common"><![CDATA[Changing the status will disable the labels on the listings.]]></phrase>
        <phrase version='3.1.0' key="lb_disabled_box" module="ext"><![CDATA[You have disabled the box with labeled listings.]]></phrase>
        <phrase version='2.4.0' key="lb_rebuilding" module="common"><![CDATA[Updating pictures has been successfully completed.]]></phrase>
        <phrase version='3.1.0' key="lb_watermark_removed" module="admin"><![CDATA[You have removed the label.]]></phrase>
        <phrase version='3.0.0' key="ls_warning_position" module="common"><![CDATA[Some labels can have a particular position.]]></phrase>
        <phrase version='3.0.0' key="ls_cannot_remove_verified" module="common"><![CDATA[You cannot remove the verified labels.]]></phrase>
        <phrase version='3.0.0' key="ls_verified_photos" module="common"><![CDATA[Verification photos]]></phrase>
        <phrase version='3.0.0' key="ls_verified_photo" module="common"><![CDATA[Verification photo]]></phrase>
        <phrase version='3.0.0' key="ls_verify_photo_request" module="common"><![CDATA[Verification requests]]></phrase>
        <phrase version='3.0.0' key="ls_verify_photos" module="common"><![CDATA[Verify photos]]></phrase>
        <phrase version='3.0.0' key="ls_verify" module="common"><![CDATA[Verify]]></phrase>
        <phrase version='3.1.0' key="ls_wait_request" module="common"><![CDATA[You have submitted your request.]]></phrase>
        <phrase version='3.0.0' key="ls_verified" module="common"><![CDATA[Verified]]></phrase>
        <phrase version='3.0.0' key="ls_unverified" module="common"><![CDATA[Unverified]]></phrase> 
        <phrase version='3.0.0' key="ls_view_list" module="common"><![CDATA[View all]]></phrase>
        <phrase version='3.0.0' key="ls_set_verified" module="common"><![CDATA[The photos have been successfully verified.]]></phrase>
        <phrase version='3.0.0' key="ls_set_wait" module="common"><![CDATA[The photos are pending to be verified.]]></phrase>
        <phrase version='3.0.0' key="ls_photos" module="common"><![CDATA[Photos]]></phrase>
        <phrase version='3.0.0' key="ls_verified_desc" module="common"><![CDATA[Type in the field below to add more details. Then upload a picture of you holding a piece of paper with "<b>[website] [date]</b>" written on it. The photo will be used solely for verification and won't be added to your listings.]]></phrase>
        <phrase version='3.0.0' key="ls_verified_details" module="common"><![CDATA[Verification Details]]></phrase>
        <phrase version='3.0.0' key="ls_pending_verification" module="common"><![CDATA[Pending]]></phrase>
        <phrase version='3.1.0' key="ls_step_done_verify" module="common"><![CDATA[Please [verify your photos] to get more leads on your profile.]]></phrase>
        <phrase version='3.0.0' key="ls_request_approved" module="common"><![CDATA[Your request for photo verification has been approved.]]></phrase>
        <phrase version='3.1.0' key="ls_label_hint" module="admin"><![CDATA[Unchanged - Listing won't be modified after that label is applied<br/>
Suspended - Listing will be suspended after an X days once that label is applied<br/>
Deleted   - Listing will be deleted after a X days once that label is applied]]></phrase>
        <phrase version='3.1.0' key="ls_set_verify_cancel" module="admin"><![CDATA[The photos were not verified.]]></phrase>
    </phrases>

    <blocks>
        <block key="lb_sold" name="Recently Sold" side="left" type="php" tpl="0"><![CDATA[
            global $reefless, $rlSmarty;
            $reefless -> loadClass("ListingStatus", null, "listing_status");
            global $rlListingStatus;
            $ls_listings = $rlListingStatus -> getRecentlySoldListings( "listings", "10", "4", "sold", "latest" );
            $rlSmarty -> assign_by_ref( "ls_listings", $ls_listings );
            $sold = "sold";
            $rlSmarty -> assign_by_ref( "ls_key", $sold );
            $rlSmarty -> display( RL_PLUGINS . "listing_status" . RL_DS . "recently_sold.block.tpl" );
        ]]></block>
    </blocks>

    <configs version="3.0.0" key="listing_status" name="Listing Labels">
        <![CDATA[]]>
        <config version="3.0.0" key="ls_verify_module" name="Verification by photo"  type="bool"><![CDATA[0]]></config>
    </configs>

    <pages>
        <page version="3.0.0" key="verify_photos" name="Verify Photos" type="system" path="verify-photos" login="1" controller="verify_photos" tpl="1" status="trash"><![CDATA[]]></page>
    </pages>

    <emails>
        <email version="3.1.0" key="verified_photos_wait_admin" subject="Photo for verification">
        <![CDATA[
        Hello,

        The user submitted his photo for verification.

        Title: {title}
        Profile id: {listing_id}

        Click [here] to check the request.
        ]]></email>
        <email version="3.0.0" key="verified_photos_resend_request_admin" subject="New photo needs to be verified">
        <![CDATA[
        Hello Administrator,
        
        The user has submitted a new photo.  
        
        Title: {title}
        Listing ID: {listing_id}     
        
        Click [here] to check the request and verify the new photo.
        ]]></email>
        <email version="3.0.0" key="verified_photos_active" subject="Your profile verified">
        <![CDATA[
        Hello {name},

        Your profile {title} with ID: {id} has been successfully verified.
        ______________________________________
        Thank you,
        {site_name} Administration

        ]]></email>
        <email version="3.1.0" key="verified_photos_cancel" subject="Failed to verify your profile">
        <![CDATA[
        Hello {name},

        Unfortunately, your request for the photo verification for the {title} profile with a unique identifier {id} was declined.

        {reason}
        ______________________________________
        Thank you,
        {site_name} Administration

        ]]></email>
    </emails>

    <updates>
        <update version="2.0.1" files="rlListingStatus.class.php"><![CDATA[]]></update>
        <update version="2.0.2" files="recently_sold.block.tpl"><![CDATA[]]></update>
        <update version="2.0.3" files="rlListingStatus.class.php"><![CDATA[]]></update>
        <update version="2.0.4"><![CDATA[]]></update>
        <update version="2.1.0" files="admin/watermark.tpl,admin/listing_status.tpl,admin/listing_status.inc.php,rlListingStatus.class.php,sold_large.psd,sold_large.png"><![CDATA[
            global $reefless;
            $reefless -> loadClass('ListingStatus', null, 'listing_status');
            $GLOBALS['rlListingStatus']->updateStatus();
        ]]></update>
        <update version="2.1.1" files="admin/listing_status.inc.php,rlListingStatus.class.php"><![CDATA[]]></update>
        <update version="2.1.2" files="rlListingStatus.class.php"><![CDATA[]]></update>
        <update version="2.1.3" files="status_selector.tpl"><![CDATA[]]></update>
        <update version="2.1.4" files="recently_sold.block.tpl,status_selector.tpl,rlListingStatus.class.php"><![CDATA[]]></update>
        <update version="2.1.5" files="status_selector.tpl"><![CDATA[]]></update>
        <update version="2.1.6" files="recently_sold.block.tpl,rlListingStatus.class.php,admin/listing_status.inc.php"><![CDATA[]]></update>
        <update version="2.1.7" files="rlListingStatus.class.php"><![CDATA[]]></update>
        <update version="2.2.0" files="rlListingStatus.class.php"><![CDATA[]]></update>
        <update version="2.3.0" files="rlListingStatus.class.php,status_selector.tpl"><![CDATA[]]></update>
        <update version="2.4.0" files="rlListingStatus.class.php,admin/listing_status.inc.php,admin/listing_status.tpl,admin/watermark.tpl,admin/refresh_labels.tpl,recently_sold.block.tpl,static/lib.js,status_selector.tpl,static/.htaccess,.htaccess"><![CDATA[
            $GLOBALS['rlDb']->query("DELETE FROM `" . RL_DBPREFIX . "hooks` WHERE `Class` = '' AND `Plugin` = 'listing_status'");
        ]]></update>
        <update version="3.0.0" files="admin/refresh_labels.tpl,admin/listing_status.inc.php,admin/listing_status.tpl,admin/watermark.tpl,rlListingStatus.class.php,static/lib.js,admin/status_admin_selector.tpl,status_selector.tpl,admin/verify_photos.inc.php,admin/verify_photos.tpl,label.box.tpl,static/style.css,verify_photos.inc.php,verify_photos.tpl,step.done.tpl,static/.htaccess,static/style-page.css"><![CDATA[
            $GLOBALS['rlDb']->query("DELETE FROM `" . RL_DBPREFIX . "hooks` WHERE `Class` = '' AND `Plugin` = 'listing_status'");
            $GLOBALS['reefless']->loadClass('ListingStatus', null, 'listing_status');
            $GLOBALS['rlListingStatus']->update300();
        ]]></update>
        <update version="3.0.1" files="rlListingStatus.class.php"><![CDATA[
            $GLOBALS['reefless']->loadClass('ListingStatus', null, 'listing_status');
            $GLOBALS['rlListingStatus']->update301();
        ]]></update>
        <update version="3.1.0" files="rlListingStatus.class.php,header.tpl,static/style.css,admin/listing_status.inc.php,admin/listing_status.tpl,admin/verify_photos.tpl,verify_photos.inc.php,verify_photos.tpl,admin/verify_photos.inc.php,admin/watermark.tpl,i18n/ru.json"><![CDATA[
            $GLOBALS['reefless']->loadClass('ListingStatus', null, 'listing_status');
            $GLOBALS['rlListingStatus']->update310();
        ]]></update>
    </updates>

    <uninstall><![CDATA[
        $GLOBALS['reefless']->loadClass('ListingStatus', null, 'listing_status');
        $GLOBALS['rlListingStatus']->uninstall();
        ]]>
    </uninstall>
</plugin>
